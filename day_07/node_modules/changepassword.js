const { readFile, writeFile } = require("./readAndWrite.js");

const changePassword = async (email, oldPassword, newPassword, filePath = "./user.json") => {
    try {
        const users = await readFile(filePath);
        let message = " ";
        
        if (users.length === 0) {
            message = "No users found. Please register first.";
        } else {
            const existingUser = users.find((u) => u.email === email);
            
            if (!existingUser) {
                message = "User not found. Please register first.";
            } else if (existingUser.password === oldPassword) {
                existingUser.password = newPassword;
                await writeFile(filePath, users);
                message = "Password changed successfully";
            } else {
                message = "Incorrect old password. Please try again.";
            }
        }
        
        console.log(message);
        return message;
    } catch (error) {
        const message = "Error during password change: " + error.message;
        console.log(message);
        return message;
    }
};

module.exports = { changePassword };
